<script>
document.addEventListener('DOMContentLoaded', () => {
    // -------------------- User System --------------------
    let users = JSON.parse(localStorage.getItem('users')) || [];
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;

    function saveUsers() { localStorage.setItem('users', JSON.stringify(users)); }
    function saveCurrentUser() { localStorage.setItem('currentUser', JSON.stringify(currentUser)); }

    const loginForm = document.getElementById('login');
    const userPanel = document.getElementById('user-panel');

    function showLogin() {
        loginForm.style.display = 'flex';
        userPanel.style.display = 'none';
    }

    function showUserPanel() {
        loginForm.style.display = 'none';
        userPanel.style.display = 'flex';
        document.getElementById('user-name').textContent = currentUser.username;
    }

    // Display correct panel on page load
    if(currentUser) showUserPanel();
    else showLogin();

    // Login
    loginForm.addEventListener('submit', e => {
        e.preventDefault();
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value.trim();
        const user = users.find(u => u.username === username && u.password === password);
        if(user){
            currentUser = user;
            saveCurrentUser();
            showUserPanel();
        } else {
            alert('Invalid username or password');
        }
    });

    // Register
    document.getElementById('register').addEventListener('submit', e => {
        e.preventDefault();
        const username = document.getElementById('reg-username').value.trim();
        const password = document.getElementById('reg-password').value.trim();
        if(users.find(u=>u.username===username)){ 
            alert('Username already exists'); 
        } else { 
            const newUser = {username, password};
            users.push(newUser); 
            saveUsers(); 
            alert('Registered successfully'); 
            document.getElementById('register').reset(); 
        }
    });

    // Logout
    document.getElementById('logout').addEventListener('click', () => {
        currentUser = null;
        saveCurrentUser();
        showLogin();
    });

    // Delete account
    document.getElementById('delete-account').addEventListener('click', () => { 
        if(currentUser && confirm('Are you sure you want to delete your account?')) { 
            users = users.filter(u => u.username !== currentUser.username); 
            saveUsers(); 
            currentUser = null; 
            saveCurrentUser();
            showLogin(); 
        } 
    });
});
</script>
